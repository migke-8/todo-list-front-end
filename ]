package migke.todo

import org.scalajs.dom.*
import scala.compiletime.ops.double
import org.scalajs.dom.webgl.ShaderPrecisionFormat

@main def main(): Unit = {
  val button = document.getElementById("button").asInstanceOf[HTMLButtonElement]
  val scoreElement = document.getElementById("score")
  val shopList = document.getElementById("shop-list")
  val shopItems = Array(ShopItem("double gain"))
  var scoreModifier = 1
  var score = 0

  shopList.append(shopItems.map(toItemElement))
  button.onclick = { (e) =>
    val buttonBox = button.getBoundingClientRect()
    button.style.left =
      Math.round(Math.random() * (window.innerWidth - buttonBox.width)) + "px"
    button.style.top =
      Math.round(Math.random() * (window.innerHeight - buttonBox.height)) + "px"
    document.body.appendChild(
      getCountJuice(scoreModifier, e.clientX, e.clientY)
    )
    score += 1
    scoreElement.innerText = "score: " + score
  }
}
case class ShopItem(name: String, price: Int, var multiplier: Int = 1)
def toItemElement(item: ShopItem) = {
  val element = document.createElement("li")
  element.innerText = s"${item.name}: ${item.price}"+"$"
  element
}
def getCountJuice(number: Int, x: Double, y: Double) = {
  val span = document.createElement("span").asInstanceOf[HTMLElement]

  span.style.left = s"${x - span.getBoundingClientRect().width}px"
  span.style.top = s"${y - span.getBoundingClientRect().height}px"
  span.classList.add("juice-count")
  span.innerText = number + "+"
  span.addEventListener("animationend", { (e) => span.remove() })
  span
}
